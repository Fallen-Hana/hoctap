<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>8A2 Trần Phú • Đăng nhập lớp học</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    const supabase = supabase.createClient(
      "https://YOUR_PROJECT.supabase.co",
      "YOUR_PUBLIC_ANON_KEY"
    );
  </script>
</head>

<body class="bg-[#0d1117] flex justify-center items-center h-screen text-white">
  <div class="bg-[#161b22] border border-gray-700 rounded-xl shadow-xl w-[380px] p-6">
    <div class="flex items-center mb-5">
      <div class="w-4 h-4 rounded-sm bg-green-400 mr-2"></div>
      <h1 class="text-lg font-semibold">8A2 Trần Phú</h1>
    </div>

    <p class="text-sm text-gray-400 mb-5">Chỉ dành cho học sinh trong lớp</p>

    <div class="mb-5">
      <label class="text-gray-300 text-sm block mb-2 font-medium">Mã học sinh</label>
      <input id="login_code" type="text" placeholder="VD: A2-14"
        class="w-full p-2 rounded-md bg-[#0d1117] border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-green-500">
    </div>

    <button id="btnLogin"
      class="w-full py-2 bg-green-500 hover:bg-green-600 rounded-md font-medium text-black transition">
      Vào lớp
    </button>

    <p id="message" class="text-center text-sm text-red-400 mt-3 h-5"></p>

    <p class="text-gray-500 text-xs text-center mt-5">
      * Dữ liệu đăng nhập lưu cục bộ trên trình duyệt.<br>
      Dùng <span class="text-gray-300">Đăng xuất</span> để đổi tài khoản.
    </p>
  </div>

  <script>
    document.getElementById('btnLogin').addEventListener('click', async () => {
      const code = document.getElementById('login_code').value.trim();
      const msg = document.getElementById('message');
      msg.textContent = "";

      if (!code) {
        msg.textContent = "⚠️ Vui lòng nhập mã học sinh.";
        return;
      }

      const { data, error } = await supabase
        .from('students')
        .select('*')
        .eq('login_code', code)
        .maybeSingle();

      if (error || !data) {
        msg.textContent = "❌ Mã học sinh không đúng. Kiểm tra lại nhé.";
        return;
      }

      // lưu thông tin vào localStorage
      localStorage.setItem('student', JSON.stringify(data));

      // chuyển sang trang chat
      window.location.href = "chat.html";
    });
  </script>
</body>
</html>
